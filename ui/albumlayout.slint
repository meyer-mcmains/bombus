import { Grid, Album, Theme } from "global.slint";
import { LargeTitle, Headline} from "typography.slint";
import { TrackLayout } from "tracklayout.slint";

export component AlbumLayout inherits VerticalLayout {
    in property <int> selected-index;
    in property <int> items-per-row;
    in property <length> offset-x;
    in property <Album> album;
    property <int> tracks-first-column-length: Math.ceil(album.tracks.length / 2);
    alignment: start;

    HorizontalLayout {
        x: mod(selected-index, items-per-row) * Grid.outer-width;
        height: 24px;
        width: Grid.inner-size;

        // Make a triangle
        Path {
            fill: Theme.color.system-fill-tertiary;
            commands: "M40 28.99H0c3.32 0 4-2 4-2L16.4 2.2c1.35-2.95 5.84-2.93 7.21 0L36 26.99s.69 2 4 2Z";
        }

        animate x {
            duration: 250ms;
            easing: ease-in-out;
        }
    }

    HorizontalLayout {
        Rectangle {
            background: Theme.color.system-fill-tertiary;
            border-radius: 16px;

            VerticalLayout {
                alignment: start;
                padding: 24px;

                HorizontalLayout {
                    alignment: stretch;
                    padding-bottom: 16px;
                    spacing: 8px;

                    Rectangle {
                        width: self.height;
                        border-radius: self.height;
                        background: play-pause.has-hover ? Theme.color.system_fill_tertiary : transparent;
                        animate background {
                            duration: 250ms;
                            easing: ease-in-out;
                        }

                        VerticalLayout {
                            alignment: center;

                            HorizontalLayout {
                                alignment: center;

                                Image {
                                    height: 24px;
                                    width: self.height;
                                    // TODO replace icon
                                    source: @image-url("../src/assets/x.svg");
                                    colorize: play-pause.has-hover ? Theme.color.system-blue : Theme.color.label-secondary;
                                    animate colorize {
                                        easing: ease-in;
                                        delay: 250ms;
                                        duration: 250ms;
                                    }
                                }
                            }
                        }

                        play-pause := TouchArea {
                            mouse-cursor: pointer;
                        }
                    }

                    VerticalLayout {
                        Rectangle {
                            Headline {
                                width: parent.width;
                                text: album.artist;
                            }
                        }

                        Rectangle {
                            LargeTitle {
                                width: parent.width;
                                text: album.title;
                            }
                        }
                    }
                }

                HorizontalLayout {
                    property <length> track-spacing: 3px;
                    property <length> track-height: 32px;
                    spacing: 12px;

                    VerticalLayout {
                        spacing: track-spacing;
                        height: tracks-first-column-length * (track-height + track-spacing);

                        for track [index] in album.tracks: Rectangle {
                            height: index < tracks-first-column-length ? track-height : 0;
                            visible: index < tracks-first-column-length;
                            if index < tracks-first-column-length: TrackLayout {
                                track: track;
                            }
                        }
                    }

                    VerticalLayout {
                        height: (album.tracks.length * (track-height + track-spacing)) - (tracks-first-column-length * (track-height + track-spacing));
                        spacing: track-spacing;

                        for track [index] in album.tracks: Rectangle {
                            height: index >= tracks-first-column-length ? track-height : 0;
                            visible: index >= tracks-first-column-length;
                            if index >= tracks-first-column-length: TrackLayout {
                                // take into account the offset off extra items
                                y: tracks-first-column-length * track-spacing * -1;
                                track: track;
                            }
                        }
                    }
                }
            }
        }
    }
}
